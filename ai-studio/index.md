# AI Studio API Guide

## Overview

The AI Studio API enables you to create AI-generated video content using Text-to-Speech (TTS), Speech-to-Face (STF), and Photo Avatar technologies. Key features include:

- **Text-to-Speech (TTS)** conversion with multiple voice types and languages
- **Speech-to-Face (STF)** generation creating realistic avatar videos from audio
- **Photo Avatar** generation creating videos from user photos with synchronized speech
- **Multiple TTS types** including AI voices and Azure TTS services  
- **Various model styles** for different avatar appearances and poses
- **Audio format options** for different quality and compatibility needs
- **Real-time status tracking** throughout the generation process

## Prerequisites

- Python 3.8+
- API key for the Perso.ai Live API service: Please contact our support team to obtain your API credentials.

## Installation

1. **Clone the repository:**
   ```bash
   git clone https://github.com/team-ailab/persolive-docs.git
   cd ai-studio
   ```

2. **Install Python dependencies:**
    ```bash
    # The script uses only the `requests` library for HTTP communication
    pip install requests
    ```

## Authentication

The system supports various authentication methods:

1. **Environment Variable (Recommended):**
   ```bash
   export EST_LIVE_API_KEY="your-api-key-here"
   python main.py
   ```

2. **Command Line Argument:**
   ```bash
   python main.py --api-key "your-api-key-here"
   ```

3. **Authentication Header (When using requests library):**
    ```python
    headers = {
        "Content-Type": "application/json",
        "PersoLive-APIKey": os.environ.get("EST_LIVE_API_KEY"),
    }
    ```

## Quick Start

### Check Available Types

Before creating content, you can check available TTS types and model styles:

1. **Check TTS types:**
   ```bash
   python main.py --check-types tts_type
   ```

2. **Check model styles:**
   ```bash
   python main.py --check-types modelstyle
   ```

### Basic TTS + STF Workflow

The `main.py` script demonstrates a complete AI video generation workflow:

1. **Basic usage:**
   ```bash
   python main.py --tts-text "Hello world"
   ```

2. **The script will:**
   - Convert your text to speech using the specified TTS type
   - Generate a video with the specified avatar model style
   - Download the audio file locally
   - Provide the final video URL

3. **Available options:**
   ```bash
   # Multiple TTS texts
   python main.py --tts-text "Hello" "I am AI" "Nice to meet you"
   
   # Different TTS type
   python main.py --tts-text "안녕하세요" --tts-type "azuretts-ko-KR-InJoonNeural-sad"
   
   # Different model style
   python main.py --tts-text "Hello" --stf-model-style "indian_m_2_aaryan-side-white_jacket-natural"

   # Different TTS type and model style
   python main.py --tts-text "Hello world" --tts-type "yuri" --stf-model-style "yuri-front_natural"
   
   # Custom save directory
   python main.py --tts-text "Hello" --save-dir "./my-outputs"
   
   # Only TTS (skip video generation)
   python main.py --tts-text "Hello" --skip-stf
   
   # Skip Photo Avatar generation
   python main.py --tts-text "Hello" --skip-photo-avatar
   
   # Custom Photo Avatar input image
   python main.py --tts-text "Hello" --photo-avatar-input-image "./my-photo.jpg"
   ```

### Photo Avatar Workflow

The Photo Avatar feature allows you to create videos using your own photos:

1. **Basic Photo Avatar usage:**
   ```bash
   # Using local image file
   python main.py --tts-text "Hello world" --skip-stf --photo-avatar-input-image "./my-photo.jpg"
   
   # Using image URL
   python main.py --tts-text "Hello world" --skip-stf --photo-avatar-input-image "https://example.com/photo.jpg"
   ```

3. **The Photo Avatar workflow will:**
   - Convert your text to speech
   - Use your provided photo (or default test image)
   - Generate a video where the person in the photo appears to speak the text
   - Provide the final Photo Avatar video URL

## API Reference

### 1. Check Available Types

**Endpoint:** `GET /api/v1/settings/{type_name}/`

Retrieves available TTS types or model styles.

**Parameters:**
- `type_name`: `tts_type` or `modelstyle`

**Response:**
```json
[
    {
        "name": "string",
        "display_name": "string",
        "description": "string"
    }
]
```

### 2. Create TTS Task

**Endpoint:** `POST /api/studio/v1/task/tts/`

Creates a text-to-speech conversion task.

**Request Parameters:**
```json
{
    "agent": "string",                 // Optional: Agent ID (auto-generated by default)
    "tts_type": "string",              // Required: TTS type (e.g., "yuri", "azuretts-ko-KR-InJoonNeural-sad")
    "tts_audio_format": "string",      // Required: Audio format ("wav_16bit_32000hz_mono" or "mp3_320kbps_mono")
    "tts_text": ["string"],            // Required: Array of texts to convert
    "tts_gap_start_ms": 1000,          // Optional: Start silence gap in milliseconds (default: 1000)
    "tts_gap_during_ms": 1000,         // Optional: Inter-sentence silence gap in milliseconds (default: 1000)
    "tts_gap_end_ms": 1000,            // Optional: End silence gap in milliseconds (default: 1000)
    "webhook_url": "string",           // Optional: Webhook URL to call on completion
    "webhook_retry": 3,                // Optional: Number of webhook retries (default: 3)
    "webhook_retry_delay_sec": 10      // Optional: Webhook retry delay in seconds (default: 10)
}
```

**Response:**
```json
{
    "task_id": "string",               // Task unique ID (with pst- prefix)
    "agent": "string",                 // Agent ID
    "status": "PENDING",               // Task status (PENDING, PROCESSING, COMPLETED, FAILED)
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "tts_type": "string",              // TTS type name
    "tts_audio_format": "string",      // Audio format
    "tts_text": ["string"],            // Input text array
    "tts_gap_start_ms": 1000,          // Start silence gap
    "tts_gap_during_ms": 1000,         // Inter-sentence silence gap
    "tts_gap_end_ms": 1000,            // End silence gap
    "tts_output_audio": null,          // Audio file URL when completed
    "tts_output_result": null,         // Detailed result information when completed
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 3. Check TTS Task Status

**Endpoint:** `GET /api/studio/v1/task/tts/{task_id}/`

Monitors the progress of a TTS task.

**Response:**
```json
{
    "task_id": "string",               // Task unique ID
    "agent": "string",                 // Agent ID  
    "status": "string",                // PENDING, PROCESSING, COMPLETED, FAILED
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "tts_type": "string",              // TTS type name
    "tts_audio_format": "string",      // Audio format
    "tts_text": ["string"],            // Input text array
    "tts_gap_start_ms": 1000,          // Start silence gap
    "tts_gap_during_ms": 1000,         // Inter-sentence silence gap
    "tts_gap_end_ms": 1000,            // End silence gap
    "tts_output_audio": "string",      // Audio file URL when completed
    "tts_output_result": "object",     // Detailed result information (JSON) when completed
    "detail": "string",                // Error details if failed
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 4. Create STF Task

**Endpoint:** `POST /api/studio/v1/task/stf/`

Creates a speech-to-face video generation task.

**Request Parameters (multipart/form-data):**
- `agent`: Agent ID (optional)
- `stf_model_style`: Model style (required, e.g., "yuri-front_natural")
- `stf_input_audio`: Audio file (required, binary upload)
- `stf_start_frame`: Start frame number (optional, default: 0)
- `stf_video_profile`: Video quality profile (optional, one of "realtime", "good", "best", default: "good")
- `stf_face_only`: Whether to render face only (optional, boolean, default: false)
- `stf_video_codec`: Video codec (optional, one of "h264_fmp4", "vp8_webm", "vp9_webm", "av1_fmp4", "av1_webm", default: "h264_fmp4")
- `webhook_url`: Webhook URL to call on completion (optional)
- `webhook_retry`: Number of webhook retries (optional, default: 3)
- `webhook_retry_delay_sec`: Webhook retry delay in seconds (optional, default: 10)

**Response:**
```json
{
    "task_id": "string",               // Task unique ID (with pst- prefix)
    "agent": "string",                 // Agent ID
    "status": "PENDING",               // Task status (PENDING, PROCESSING, COMPLETED, FAILED)
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "stf_model_style": "string",       // Model style name
    "stf_input_audio": "string",       // Input audio file URL
    "stf_start_frame": 0,              // Start frame number
    "stf_video_profile": "good",       // Video quality profile
    "stf_face_only": false,            // Whether to render face only
    "stf_video_codec": "h264_fmp4",    // Video codec
    "stf_output_video": "string",      // Output video file URL (streaming endpoint during generation)
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 5. Check STF Task Status

**Endpoint:** `GET /api/studio/v1/task/stf/{task_id}/`

Monitors the progress of an STF task.

**Response:**
```json
{
    "task_id": "string",               // Task unique ID
    "agent": "string",                 // Agent ID
    "status": "string",                // PENDING, PROCESSING, COMPLETED, FAILED
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "stf_model_style": "string",       // Model style name
    "stf_input_audio": "string",       // Input audio file URL
    "stf_start_frame": 0,              // Start frame number
    "stf_video_profile": "good",       // Video quality profile
    "stf_face_only": false,            // Whether to render face only
    "stf_video_codec": "h264_fmp4",    // Video codec
    "stf_output_video": "string",      // Video file URL when completed (COMPLETED status)
    "detail": "string",                // Error details if failed
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 6. Create Photo Avatar Task

**Endpoint:** `POST /api/studio/v1/task/photoavatar/`

Creates a photo avatar video generation task using a user-provided photo.

**Request Parameters (multipart/form-data):**
- `agent`: Agent ID (optional)
- `photoavatar_input_image`: Image file (binary upload) - person's photo to animate
- `photoavatar_input_image_url`: Image URL (alternative to file upload)
- `photoavatar_input_audio`: Audio file (binary upload) - speech audio to sync
- `photoavatar_input_audio_url`: Audio URL (alternative to file upload)
- `webhook_url`: Webhook URL to call on completion (optional)
- `webhook_retry`: Number of webhook retries (optional, default: 3)
- `webhook_retry_delay_sec`: Webhook retry delay in seconds (optional, default: 10)

**Response:**
```json
{
    "task_id": "string",                        // Task unique ID (with pst- prefix)
    "agent": "string",                          // Agent ID
    "status": "PENDING",                        // Task status (PENDING, PROCESSING, COMPLETED, FAILED)
    "created_at": "datetime",                   // Task creation time
    "updated_at": "datetime",                   // Task update time
    "photoavatar_input_image": null,            // Input image file path (null when using URL)
    "photoavatar_input_image_url": "string",    // Input image URL (when using URL instead of file)
    "photoavatar_input_audio": null,            // Input audio file path (null when using URL)
    "photoavatar_input_audio_url": "string",    // Input audio URL (when using URL instead of file)
    "photoavatar_output_video": null,           // Output video file URL (null until completed)
    "webhook_url": null,                        // Webhook URL (null if not provided)
    "webhook_retry": 3,                         // Number of webhook retries
    "webhook_retry_delay_sec": 10               // Webhook retry delay
}
```

### 7. Check Photo Avatar Task Status

**Endpoint:** `GET /api/studio/v1/task/photoavatar/{task_id}/`

Monitors the progress of a Photo Avatar task.

**Response:**
```json
{
    "task_id": "string",                        // Task unique ID
    "agent": "string",                          // Agent ID
    "status": "string",                         // PENDING, PROCESSING, COMPLETED, FAILED
    "created_at": "datetime",                   // Task creation time
    "updated_at": "datetime",                   // Task update time
    "photoavatar_input_image": null,            // Input image file path (null when using URL)
    "photoavatar_input_image_url": "string",    // Input image URL (when using URL instead of file)
    "photoavatar_input_audio": null,            // Input audio file path (null when using URL)
    "photoavatar_input_audio_url": "string",    // Input audio URL (when using URL instead of file)
    "photoavatar_output_video": null,           // Video file URL when completed (null until COMPLETED status)
    "detail": "string",                         // Error details if failed
    "webhook_url": null,                        // Webhook URL (null if not provided)
    "webhook_retry": 3,                         // Number of webhook retries
    "webhook_retry_delay_sec": 10               // Webhook retry delay
}
```

### 8. Stream STF Video (Real-time Streaming)

**Endpoint:** `GET /api/studio/v1/task/stf/{task_id}/stream_video/`

Streams the STF task video in real-time. You can view the progress in real-time even while the video is being generated.

**Response:**
- Content-Type: video/mp4 or video/webm (depending on codec)
- Streaming video data (binary)

**Note:** 
- This endpoint is available even when the task is in PROCESSING status
- Video is streamed in real-time during generation
- Returns an error if the task is in FAILED status or the file doesn't exist

## TTS Types
Popular TTS types include:
- `yuri` - Default AI voice
- `azuretts-ko-KR-InJoonNeural-sad` - Korean male voice (sad tone)
- `azuretts-en-US-JennyNeural-cheerful` - English female voice (cheerful tone)
- `azuretts-ja-JP-NanamiNeural-gentle` - Japanese female voice (gentle tone)

## Model Styles
Popular model styles include:
- `yuri-front_natural` - Female avatar, front view, natural pose
- `indian_m_2_aaryan-side-white_jacket-natural` - Male avatar, side view, business attire
- `korean_f_1_suji-front-casual-natural` - Korean female avatar, casual style

## Audio Formats

Supported audio formats:
- `wav_16bit_32000hz_mono` - High quality WAV (default)
- `mp3_320kbps_mono` - Compressed MP3

## Video Codec Options

Supported video codecs:
- `h264_fmp4` - H.264 MP4 format (default, excellent compatibility)
- `vp8_webm` - VP8 WebM format
- `vp9_webm` - VP9 WebM format (better compression)
- `av1_fmp4` - AV1 MP4 format (latest compression technology)
- `av1_webm` - AV1 WebM format

## Video Quality Profiles

Video generation quality options:
- `realtime` - Real-time generation (speed priority)
- `good` - Balanced quality (default)
- `best` - Highest quality (takes longer)

## Status Values

- **PENDING**: Task queued for processing
- **PROCESSING**: Task currently running
- **COMPLETED**: Task finished successfully  
- **FAILED**: Task encountered an error

## Error Handling

Always check the HTTP status code and response body for error details:

```python
if response.status_code >= 400:
    print(f"Error {response.status_code}: {response.text}")
```

error codes:
- `400`: Bad Request - Invalid parameters
- `401`: Unauthorized - Invalid API key
- `404`: Not Found - Resource doesn't exist
- `413`: Payload Too Large - File too big
- `429`: Rate Limited - Too many requests
- `500`: Internal Server Error - Server issue
