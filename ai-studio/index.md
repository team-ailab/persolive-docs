# AI Studio API Guide

## Overview

The AI Studio API enables you to create AI-generated video content using Text-to-Speech (TTS) and Speech-to-Face (STF) technologies. Key features include:

- **Text-to-Speech (TTS)** conversion with multiple voice types and languages
- **Speech-to-Face (STF)** generation creating realistic avatar videos from audio
- **Multiple TTS types** including AI voices and Azure TTS services  
- **Various model styles** for different avatar appearances and poses
- **Audio format options** for different quality and compatibility needs
- **Real-time task monitoring** throughout the generation process

## Prerequisites

You need an API key issued by Perso.ai to use this service. Please contact our support team to obtain your API credentials.

- API Key: Contact Perso.ai support team
- Base URL: `https://live-api.perso.ai`

## Installation

**Python Version:** 3.8 or higher

**Required packages:**
```bash
pip install requests
```

The script uses only the `requests` library for HTTP communication and standard Python libraries (`json`, `os`, `time`, `urllib.parse`, `pathlib`).

## Authentication

You must include your API key in the request headers as follows:

```python
headers = {
    "Content-Type": "application/json",
    "PersoLive-APIKey": os.environ.get("EST_LIVE_API_KEY"),
}
```

**Environment Setup:**
```bash
export EST_LIVE_API_KEY="your-api-key-here"
```

## Quick Start

### Check Available Types

Before creating content, you can check available TTS types and model styles:

1. **Check TTS types:**
   ```bash
   python main.py --check-types tts_type
   ```

2. **Check model styles:**
   ```bash
   python main.py --check-types modelstyle
   ```

### Basic TTS + STF Workflow

The `main.py` script demonstrates a complete AI video generation workflow:

1. **Basic usage:**
   ```bash
   python main.py --tts-text "Hello world" --tts-type "yuri" --stf-model-style "yuri-front_natural"
   ```

2. **The script will:**
   - Convert your text to speech using the specified TTS type
   - Generate a video with the specified avatar model style
   - Download the audio file locally
   - Provide the final video URL

3. **Available options:**
   ```bash
   # Basic generation
   python main.py --tts-text "Hello world"
   
   # Multiple texts
   python main.py --tts-text "Hello" "I am AI" "Nice to meet you"
   
   # Different TTS type
   python main.py --tts-text "안녕하세요" --tts-type "azuretts-ko-KR-InJoonNeural-sad"
   
   # Different model style
   python main.py --tts-text "Hello" --stf-model-style "indian_m_2_aaryan-side-white_jacket-natural"
   
   # Custom save directory
   python main.py --tts-text "Hello" --save-dir "./my-outputs"
   
   # Only TTS (skip video generation)
   python main.py --tts-text "Hello" --skip-stf
   
   # With custom API key
   python main.py --tts-text "Hello" --api-key "your-key"
   ```

### Complete Workflow Example

1. **Step 1 - Check Available Options:**
   ```bash
   # Check available TTS types
   python main.py --check-types tts_type
   
   # Check available model styles  
   python main.py --check-types modelstyle
   ```

2. **Step 2 - Generate Content:**
   ```bash
   # Generate video with default settings
   python main.py --tts-text "Hello, I am your AI assistant"
   
   # Generate with specific settings
   python main.py --tts-text "안녕하세요" --tts-type "azuretts-ko-KR-InJoonNeural-sad" --stf-model-style "yuri-front_natural"
   ```

3. **Step 3 - Review Results:**
   The script will output the local audio file path and the final video URL when completed.

## API Reference

### 1. Check Available Types

**Endpoint:** `GET /api/v1/settings/{type_name}/`

Retrieves available TTS types or model styles.

**Parameters:**
- `type_name`: `tts_type` or `modelstyle`

**Response:**
```json
[
    {
        "name": "string",
        "display_name": "string",
        "description": "string"
    }
]
```

### 2. Create TTS Task

**Endpoint:** `POST /api/studio/v1/task/tts/`

Creates a text-to-speech conversion task.

**Request Parameters:**
```json
{
    "agent": "string",                   // Optional: Agent ID (auto-generated by default)
    "tts_type": "string",               // Required: TTS type (e.g., "yuri", "azuretts-ko-KR-InJoonNeural-sad")
    "tts_audio_format": "string",       // Required: Audio format ("wav_16bit_32000hz_mono" or "mp3_320kbps_mono")
    "tts_text": ["string"],             // Required: Array of texts to convert
    "tts_gap_start_ms": 1000,          // Optional: Start silence gap in milliseconds (default: 1000)
    "tts_gap_during_ms": 1000,         // Optional: Inter-sentence silence gap in milliseconds (default: 1000)
    "tts_gap_end_ms": 1000,            // Optional: End silence gap in milliseconds (default: 1000)
    "webhook_url": "string",           // Optional: Webhook URL to call on completion
    "webhook_retry": 3,                // Optional: Number of webhook retries (default: 3)
    "webhook_retry_delay_sec": 10      // Optional: Webhook retry delay in seconds (default: 10)
}
```

**Response:**
```json
{
    "task_id": "string",               // Task unique ID (with pst- prefix)
    "agent": "string",                 // Agent ID
    "status": "PENDING",               // Task status (PENDING, PROCESSING, COMPLETED, FAILED)
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "tts_type": "string",              // TTS type name
    "tts_audio_format": "string",      // Audio format
    "tts_text": ["string"],            // Input text array
    "tts_gap_start_ms": 1000,          // Start silence gap
    "tts_gap_during_ms": 1000,         // Inter-sentence silence gap
    "tts_gap_end_ms": 1000,            // End silence gap
    "tts_output_audio": null,          // Audio file URL when completed
    "tts_output_result": null,         // Detailed result information when completed
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 3. Check TTS Task Status

**Endpoint:** `GET /api/studio/v1/task/tts/{task_id}/`

Monitors the progress of a TTS task.

**Response:**
```json
{
    "task_id": "string",               // Task unique ID
    "agent": "string",                 // Agent ID  
    "status": "string",                // PENDING, PROCESSING, COMPLETED, FAILED
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "tts_type": "string",              // TTS type name
    "tts_audio_format": "string",      // Audio format
    "tts_text": ["string"],            // Input text array
    "tts_gap_start_ms": 1000,          // Start silence gap
    "tts_gap_during_ms": 1000,         // Inter-sentence silence gap
    "tts_gap_end_ms": 1000,            // End silence gap
    "tts_output_audio": "string",      // Audio file URL when completed
    "tts_output_result": "object",     // Detailed result information (JSON) when completed
    "detail": "string",                // Error details if failed
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 4. Create STF Task

**Endpoint:** `POST /api/studio/v1/task/stf/`

Creates a speech-to-face video generation task.

**Request Parameters (multipart/form-data):**
- `agent`: Agent ID (optional)
- `stf_model_style`: Model style (required, e.g., "yuri-front_natural")
- `stf_input_audio`: Audio file (required, binary upload)
- `stf_start_frame`: Start frame number (optional, default: 0)
- `stf_video_profile`: Video quality profile (optional, one of "realtime", "good", "best", default: "good")
- `stf_face_only`: Whether to render face only (optional, boolean, default: false)
- `stf_video_codec`: Video codec (optional, one of "h264_fmp4", "vp8_webm", "vp9_webm", "av1_fmp4", "av1_webm", default: "h264_fmp4")
- `webhook_url`: Webhook URL to call on completion (optional)
- `webhook_retry`: Number of webhook retries (optional, default: 3)
- `webhook_retry_delay_sec`: Webhook retry delay in seconds (optional, default: 10)

**Response:**
```json
{
    "task_id": "string",               // Task unique ID (with pst- prefix)
    "agent": "string",                 // Agent ID
    "status": "PENDING",               // Task status (PENDING, PROCESSING, COMPLETED, FAILED)
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "stf_model_style": "string",       // Model style name
    "stf_input_audio": "string",       // Input audio file URL
    "stf_start_frame": 0,              // Start frame number
    "stf_video_profile": "good",       // Video quality profile
    "stf_face_only": false,            // Whether to render face only
    "stf_video_codec": "h264_fmp4",    // Video codec
    "stf_output_video": "string",      // Output video file URL (streaming endpoint during generation)
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 5. Check STF Task Status

**Endpoint:** `GET /api/studio/v1/task/stf/{task_id}/`

Monitors the progress of an STF task.

**Response:**
```json
{
    "task_id": "string",               // Task unique ID
    "agent": "string",                 // Agent ID
    "status": "string",                // PENDING, PROCESSING, COMPLETED, FAILED
    "created_at": "datetime",          // Task creation time
    "updated_at": "datetime",          // Task update time
    "stf_model_style": "string",       // Model style name
    "stf_input_audio": "string",       // Input audio file URL
    "stf_start_frame": 0,              // Start frame number
    "stf_video_profile": "good",       // Video quality profile
    "stf_face_only": false,            // Whether to render face only
    "stf_video_codec": "h264_fmp4",    // Video codec
    "stf_output_video": "string",      // Video file URL when completed (COMPLETED status)
    "detail": "string",                // Error details if failed
    "webhook_url": "string",           // Webhook URL
    "webhook_retry": 3,                // Number of webhook retries
    "webhook_retry_delay_sec": 10      // Webhook retry delay
}
```

### 6. Stream STF Video (Real-time Streaming)

**Endpoint:** `GET /api/studio/v1/task/stf/{task_id}/stream_video/`

Streams the STF task video in real-time. You can view the progress in real-time even while the video is being generated.

**Response:**
- Content-Type: video/mp4 or video/webm (depending on codec)
- Streaming video data (binary)

**Note:** 
- This endpoint is available even when the task is in PROCESSING status
- Video is streamed in real-time during generation
- Returns an error if the task is in FAILED status or the file doesn't exist

## Common TTS Types

Popular TTS types include:
- `yuri` - Default AI voice
- `azuretts-ko-KR-InJoonNeural-sad` - Korean male voice (sad tone)
- `azuretts-en-US-JennyNeural-cheerful` - English female voice (cheerful tone)
- `azuretts-ja-JP-NanamiNeural-gentle` - Japanese female voice (gentle tone)

## Common Model Styles

Popular model styles include:
- `yuri-front_natural` - Female avatar, front view, natural pose
- `indian_m_2_aaryan-side-white_jacket-natural` - Male avatar, side view, business attire
- `korean_f_1_suji-front-casual-natural` - Korean female avatar, casual style

## Audio Formats

Supported audio formats:
- `wav_16bit_32000hz_mono` - High quality WAV (default)
- `mp3_320kbps_mono` - Compressed MP3

## Video Codec Options

Supported video codecs:
- `h264_fmp4` - H.264 MP4 format (default, excellent compatibility)
- `vp8_webm` - VP8 WebM format
- `vp9_webm` - VP9 WebM format (better compression)
- `av1_fmp4` - AV1 MP4 format (latest compression technology)
- `av1_webm` - AV1 WebM format

## Video Quality Profiles

Video generation quality options:
- `realtime` - Real-time generation (speed priority)
- `good` - Balanced quality (default)
- `best` - Highest quality (takes longer)

## Status Values

- **PENDING**: Task queued for processing
- **PROCESSING**: Task currently running
- **COMPLETED**: Task finished successfully  
- **FAILED**: Task encountered an error

## Error Handling

Always check the HTTP status code and response body for error details:

```python
if response.status_code >= 400:
    print(f"Error {response.status_code}: {response.text}")
```

Common error codes:
- `400`: Bad Request - Invalid parameters
- `401`: Unauthorized - Invalid API key
- `404`: Not Found - Resource doesn't exist
- `413`: Payload Too Large - File too big
- `429`: Rate Limited - Too many requests
- `500`: Internal Server Error - Server issue
